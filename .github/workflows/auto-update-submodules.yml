name: Auto Update Submodules

on:
  repository_dispatch:
    types: [update-submodule]
  workflow_dispatch:
    inputs:
      submodule:
        description: 'Submodule to update'
        required: true
        type: choice
        options:
          - AgeOfMax
          - FireCastle
          - AuTuneOnline
          - CasinoIdleSlots
          - TestoMax
          - BetterBestie
          - dl4j-graph-explorer

permissions:
  contents: write

jobs:
  update-submodule:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout with submodules
        uses: actions/checkout@v4
        with:
          submodules: true
          fetch-depth: 0

      - name: Configure Git
        run: |
          git config user.name "GitHub Actions Bot"
          git config user.email "actions@github.com"

      - name: Update Submodule
        run: |
          SUBMODULE="${{ github.event.client_payload.submodule || inputs.submodule }}"
          echo "🔄 Updating submodule: $SUBMODULE"
          
          cd $SUBMODULE
          git fetch origin main
          git checkout origin/main
          cd ..
          
          git add $SUBMODULE
          
          if git diff --staged --quiet; then
            echo "✅ Already up to date"
          else
            git commit -m "🔄 Update $SUBMODULE to latest version"
            git pull --rebase origin main
            git push
            echo "✅ Successfully updated $SUBMODULE"
          fi
